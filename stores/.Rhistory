mnz_med = import("C:/Users/Sofia/Documents/2022-2/BigData/PS3_Gomez-Ortiz-Vanegas-/stores/mnz_med.rds")
colnames(mnz_med)
#definir polígono de chapinero
chapinero <- getbb(place_name = "UPZ Chapinero, Bogota",
featuretype = "boundary:administrative",
format_out = "sf_polygon") %>% .$multipolygon
#definir polígono de El Poblado
poblado <- getbb(place_name = "Comuna 14 - El Poblado",
featuretype = "boundary:administrative",
format_out = "sf_polygon")
#definir polígono de Medellín
medellin <- getbb(place_name = "Medellín",
featuretype = "boundary:administrative",
format_out = "sf_polygon")
# limitar datos de manzanas al área de interés
#uniformar
house_train_bog = st_transform(house_train_bog, crs=4326)
house_test_bog = st_transform(house_test_bog, crs=4326)
house_train_med = st_transform(house_train_med, crs=4326)
house_test_med = st_transform(house_test_med, crs=4326)
#Manzanas y apartamentos limitados a chapinero y el poblado:
#chapinero
chapi_train <- house_train_bog[chapinero,]
chapi_test <- house_test_bog[chapinero,]
chapi_mnz <- mnz_bog[chapinero,]
leaflet() %>% addTiles() %>% addPolygons (data = chapinero, color="red")  %>% addCircles (data = chapi_test, color="green") %>% addCircles (data = chapi_train, color="purple")
#El Poblado - para medellín casi todos los datos de train se encuentran fuera del poblado, así que se usarán los datos de toda la ciudad
## Primera variable para bogotá y medellín: Crear variable "distancia mínima a las estaciones de transporte masivo"
## a partir de información externa (OSM)
# Importar datos de estaciones de transporte masivo en el área de interés
bus_bog = opq(bbox = st_bbox(chapi_mnz)) %>%
add_osm_feature(key = "amenity", value = "bus_station") %>%
osmdata_sf() %>% .$osm_points %>% select(osm_id,name)
bus_ant = opq(bbox = st_bbox(mnz_med)) %>%
add_osm_feature(key = "amenity", value = "bus_station") %>%
osmdata_sf() %>% .$osm_points %>% select(osm_id,name)
bus_med <- bus_ant[medellin,]
# Medir distancia de los apartamentos a las estaciones de transporte
dist_med_bus_train = st_distance(x = house_train_med, y = bus_med)
dist_med_bus_test = st_distance(x = house_test_med, y = bus_med)
dist_chapi_bus_train = st_distance(x = chapi_train, y = bus_bog)
dist_chapi_bus_test = st_distance(x = chapi_test, y = bus_bog)
# Medir la mínima distancia de los apartamentos a las estaciones de transporte
min_med_bus_train = apply(dist_med_bus_train , 1 , min)
min_med_bus_test = apply(dist_med_bus_test , 1 , min)
min__chapi_bus_train = apply(dist_chapi_bus_train , 1 , min)
min__chapi_bus_test = apply(dist_chapi_bus_test , 1 , min)
house_train_med$dist_med_bus = min_med_bus_train #juntar a bases disponibles
house_test_med$dist_med_bus = min_med_bus_test
chapi_train$dist_chapi_bus = min__chapi_bus_train
chapi_test$dist_chapi_bus = min__chapi_bus_test
## Segunda variable para bogotá: distancia mínima a los cerros orientales
osm1 = opq(bbox = getbb("Bogota")) %>%
add_osm_feature(key="natural" , value="peak")
class(osm1)
osm1_sf = osm1 %>% osmdata_sf()
osm1_sf
chapi_east = osm1_sf$osm_points %>% select(osm_id)
#distancia a los cerros
dist_east_train = st_distance(x = chapi_train, y = chapi_east)
dist_east_test = st_distance(x = chapi_test, y = chapi_east)
#distancia mínima
min_east_train = apply(dist_east_train , 1 , min)
min_east_test = apply(dist_east_test , 1 , min)
#juntar a bases disponibles (aptos y aptos + manzanas)
chapi_train$dist_east = min_east_train
chapi_test$dist_east = min_east_test
## Segunda variable para medellín: distancia mínima al campo de golf
osm2 = opq(bbox = getbb("Medellín")) %>%
add_osm_feature(key="leisure" , value="golf_course")
class(osm2)
osm2_sf = osm2 %>% osmdata_sf()
osm2_sf
pob_golf = osm2_sf$osm_polygons %>% select(osm_id)
dist_golf_train = st_distance(x = house_train_med, y = pob_golf)
dist_golf_test = st_distance(x = house_test_med, y = pob_golf)
#distancia mínima
min_golf_train = apply(dist_golf_train , 1 , min)
min_golf_test = apply(dist_golf_test , 1 , min)
#juntar a bases disponibles
house_train_med$dist_golf = min_golf_train
house_test_med$dist_golf = min_golf_test
#GRÁFICAS PARA DOCUMENTO (MOSTRANDO VARIABLES ESPACIALES DISPONIBLES)
#Bogotá
library (sp)
column1 <- cbind(c(4.6947,4.6201,4.6174,4.6805, 4.6947))
column2 <- cbind(c(-74.0664,-74.0803,-74.0058,-73.9917, -74.0664))
coords <- cbind(column2,column1)
oriente_bogota <- st_polygon(list(coords))
leaflet() %>% addTiles() %>% addPolygons (data = oriente_bogota, color="red")  %>% addPolygons (data = chapinero, color="green")
leaflet() %>% addTiles() %>% addPolygons (data = chapinero, color="red")  %>% addCircles (data = house_bog, color="green")
pob_cerros <- pob_east[oriente_bogota,]
pob_cerros <- chapi_east[oriente_bogota,]
chapi_1 <- chapi_train$price ~ chapi_train$dist_chapi_bus + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface
med_1 <- house_train_med$price ~ house_train_med$dist_cerros + house_train_med$dist_med_bus + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface
chapi_train$dist_chapi_bus2 <- chapi_train$dist_east + chapi_train$dist_chapi_bus*chapi_train$dist_chapi_bus
chapi_train$dist_east2 <- chapi_train$dist_east*chapi_train$dist_east
chapi_train$surface2 <- chapi_train$surface*chapi_train$surface
house_train_med$dist_med_bus2 <- house_train_med$dist_med_bus*house_train_med$dist_med_bus
house_train_med$dist_golf2 <- house_train_med$dist_golf*house_train_med$dist_golf
house_train_med$surface2 <- house_train_med$surface*house_train_med$surface
chapi_2 <- chapi_train$price ~ chapi_train$dist_east2 + chapi_train$dist_chapi_bus2 + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface2
med_2 <- house_train_med$price ~ house_train_med$dist_golf2 + house_train_med$dist_med_bus2 + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface2
chapi_train$price <-unlist(chapi_train$price)
st_geometry(chapi_train$price) = NULL
st_geometry(house_train_med$price) = NULL
chapi_train$price <-unlist(chapi_train$price)
lm_chapi1 <- lm(chapi_1, data=chapi_train)
pred_ols_chapi1 <- predict(lm_chapi1)
lm_chapi2 <- lm(chapi_2, data=chapi_train)
pred_ols_chapi2 <- predict(lm_chapi2)
library(rpart)
rf_chapi1 <- rpart(chapi_1, data=chapi_train)
rf_chapi2 <- rpart(chapi_2, data=chapi_train)
install.packages('xgboost')
library(xgboost)
library(readr)
library(stringr)
library(caret)
library(car)
st_geometry(chapi_train) = NULL
st_geometry(house_train_med) = NULL
chapi_train1 <- unlist(chapi_train)
chapi_train1 <- as.numeric(chapi_train1)
chapi_train_mat <- as.matrix(chapi_train1,rownames=NULL, rownames.value=NULL)
xgb_chapi1 <- xgboost(data = chapi_train[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_train_mat <- as.matrix(chapi_train1)
xgb_chapi1 <- xgboost(data = chapi_train[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_train_matriz <- as.matrix(chapi_train1,rownames=NULL, rownames.value=NULL)
xgb_chapi1 <- xgboost(data = chapi_train_matriz[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_train_matriz <- as.matrix(chapi_train1)
xgb_chapi1 <- xgboost(data = chapi_train_matriz[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_train_matriz[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")]
chapi_train[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")]
xgb_chapi1 <- xgboost(data = chapi_train[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
View(chapi_train)
chapi_matriz[chapi_train,c(1,3,4,5,6,9,10,11)]
chapi_matriz1<-[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1 <- chapi_train[,c(1,3,4,5,6,9,10,11)]
View(chapi_matriz1)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c("dist_east","dist_chapi_bus","surface","tiene_garaje","tiene_terraza","bedrooms")], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c((1,3,4,5,6,9,10,11))], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1[c((1,3,4,5,6,9,10,11))], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1, label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
class(chapi_matriz1)
chapi_matriz1 <- as.matrix(chapi_matriz1)
class(chapi_matriz1)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,3,4,5,6,9,10,11)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1 <- chapi_train[,c(1,3,4,5,6,9,10,11,12,13,14)]
chapi_matriz1 <- as.matrix(chapi_matriz1)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,3,4,5,6,9,10,11)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1 <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1 <- as.matrix(chapi_matriz1)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,3,4,5,6,9,10,11)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1 <- as.numeric(chapi_matriz1)
chapi_matriz1 <- as.matrix(chapi_matriz1)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
View(chapi_matriz1)
chapi_matriz1 <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1 <- as.matrix(chapi_matriz1)
View(chapi_matriz1)
class(chapi_matriz1)
chapi_1 <- chapi_train$price ~ chapi_train$dist_east+chapi_train$dist_chapi_bus + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface
med_1 <- house_train_med$price ~ house_train_med$dist_cerros + house_train_med$dist_med_bus + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface
chapi_train$dist_chapi_bus2 <- chapi_train$dist_east + chapi_train$dist_chapi_bus*chapi_train$dist_chapi_bus
chapi_train$dist_east2 <- chapi_train$dist_east*chapi_train$dist_east
chapi_train$surface2 <- chapi_train$surface*chapi_train$surface
house_train_med$dist_med_bus2 <- house_train_med$dist_med_bus*house_train_med$dist_med_bus
house_train_med$dist_golf2 <- house_train_med$dist_golf*house_train_med$dist_golf
house_train_med$surface2 <- house_train_med$surface*house_train_med$surface
chapi_2 <- chapi_train$price ~ chapi_train$dist_east2 + chapi_train$dist_chapi_bus2 + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface2
med_2 <- house_train_med$price ~ house_train_med$dist_golf2 + house_train_med$dist_med_bus2 + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface2
chapi_train$price <-unlist(chapi_train$price)
lm_chapi1 <- lm(chapi_1, data=chapi_train)
pred_ols_chapi1 <- predict(lm_chapi1)
lm_chapi2 <- lm(chapi_2, data=chapi_train)
pred_ols_chapi2 <- predict(lm_chapi2)
library(rpart)
rf_chapi1 <- rpart(chapi_1, data=chapi_train)
rf_chapi2 <- rpart(chapi_2, data=chapi_train)
install.packages('xgboost')
library(xgboost)
library(readr)
library(stringr)
library(caret)
library(car)
install.packages("xgboost")
sparse_matrix <- sparse.model.matrix(price ~ dist_east+dist_chapi_bus + bedrooms + tiene_terraza + tiene_garaje+ surface, data = chapi_train)[,-1]
install.packages(model.Matrix)
install.packages("ModelMatrixModel")
sparse_matrix <- sparse.model.matrix(price ~ dist_east+dist_chapi_bus + bedrooms + tiene_terraza + tiene_garaje+ surface, data = chapi_train)[,-1]
require(Matrix)
require(data.table)
sparse_matrix <- sparse.model.matrix(price ~ dist_east+dist_chapi_bus + bedrooms + tiene_terraza + tiene_garaje+ surface, data = chapi_train)[,-1]
chapi_train_dmat = xgb.DMatrix(sparse_matrix, label = chapi$matrix)
chapi_train_dmat = xgb.DMatrix(sparse_matrix, price = chapi_train$price)
chapi_train_dmat = xgb.DMatrix(sparse_matrix, label = chapi_train$price)
View(sparse_matrix)
chapi_train_dmat = xgb.DMatrix(sparse_matrix, label = df$label)
chapi_matriz1 <- chapi_train[,c(1,3,4,5,6,9,10,11)]
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1 <- as.matrix(chapi_matriz1)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_train_dmat = xgb.DMatrix(sparse_matrix, label = label)
chapi_mat1 = xgb.DMatrix(chapi_matriz1, label = label)
View(chapi_train)
chapi_matriz1_xg <- chapi_train[,c(3,4,5,6,9,10,11)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1[,c(1,2,3,4,5,6,7)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
View(chapi_matriz1_xg)
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
chapi_matriz1_xg <- numeric(chapi_matriz1_xg)
chapi_matriz1_xg <- as.numeric(chapi_matriz1_xg)
st_geometry(chapi_train) = NULL
st_geometry(house_train_med) = NULL
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
View(chapi_matriz1_xg)
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
class(chapi_matriz1_xg)
class(chapi_matriz1_xg$price)
lapply(chapi_matriz1_xg,class)
sapply(chapi_matriz1_xg,class)
unlist(lapply(chapi_matriz1_xg,class))
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
chapi_matriz1_xg$price <- as.numeric(as.character(chapi_matriz1_xg$price))
chapi_matriz1_xg$dist_east <- as.numeric(as.character(chapi_matriz1_xg$dist_east))
View(chapi_matriz1_xg)
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg$property_id <- as.numeric(as.character(chapi_matriz1_xg$property_id))
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg$property_id <- as.numeric(as.character(chapi_matriz1_xg$property_id))
View(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
View(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
prueba <- sparse.model.matrix(chapi_matriz1_xg, data = chapi_matriz1_xg,
contrasts.arg = NULL, xlev = NULL, transpose = FALSE,
drop.unused.levels = FALSE, row.names = TRUE,
sep = "", verbose = FALSE)
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
st_geometry(chapi_train$property_id) = NULL
st_geometry(house_train_med$property_id) = NULL
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
st_geometry(chapi_matriz1_xg$property_id) = NULL
View(chapi_matriz1_xg)
st_geometry(chapi_matriz1_xg$bedrooms) = NULL
st_geometry(chapi_matriz1_xg$tiene_terraza) = NULL
st_geometry(chapi_matriz1_xg$tiene_garaje) = NULL
st_geometry(chapi_matriz1_xg$surface) = NULL
st_geometry(chapi_matriz1_xg$price) = NULL
st_geometry(chapi_matriz1_xg$dist_chapi_bus) = NULL
st_geometry(chapi_matriz1_xg$dist_east) = NULL
sparse_matrix <- sparse.model.matrix(tiene_terraza ~ .-1, data = chapi_matriz1_xg)
View(sparse_matrix)
View(sparse_matrix)
class(sparse_matrix)
matrix <- sparse.model.matrix(tiene_terraza ~ .-1, data = chapi_matriz1_xg)
class(matrix)
matrix <- sparse.model.matrix(response ~ .-1, data = chapi_matriz1_xg)
chapi_matriz1_xg$identificador <- 1:13473
View(chapi_matriz1_xg)
class(chapi_matriz1_xg$identificador)
chapi_matriz1_xg$terraza <- 0
View(chapi_matriz1_xg)
chapi_matriz1_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
class(chapi_matriz1_xg$terraza)
st_geometry(chapi_matriz1_xg$terraza) = NULL
View(chapi_matriz1_xg)
chapi_matriz1_xg$hay_terraza <- 0
View(chapi_matriz1_xg)
chapi_matriz1_xg$hay_terraza <- 1 case_when(terraza=="TRUE")
chapi_matriz1_xg$hay_terraza <- 1 case_when(chapi_matriz1_xg$terraza=="TRUE")
chapi_matriz1_xg$hay_terraza <- 1 when(chapi_matriz1_xg$terraza=="TRUE")
chapi_matriz1_xg$hay_terraza[chapi_matriz1_xg$terraza == "TRUE"] <- 1
View(chapi_matriz1_xg)
View(chapi_matriz1_xg)
class(chapi_matriz1_xg$hay_terraza)
chapi_matriz1_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
chapi_matriz1_xg$garaje = chapi_matriz1_xg[,"tiene_garaje"] == "1"
chapi_matriz1_xg$hay_garaje <- 0
chapi_matriz1_xg$hay_garaje[chapi_matriz1_xg$garaje == "TRUE"] <- 1
View(chapi_matriz1_xg)
View(chapi_matriz1_xg)
chapi_matriz1_xg <- chapi_train[,c(2,5,6,7,8,9,11,13)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
chapi_matriz1_xg <- chapi_train[,c(2,5,6,7,8,9,11,13)]
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(2,5,6,7,8,9,11,13)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
class(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_train <- as.data.frame(rasterToPoints(chapi_train,spatial = TRUE))
class(chapi_train)
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg$identificador <- 1:13473
chapi_matriz1_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
chapi_matriz1_xg$hay_terraza <- 0
chapi_matriz1_xg$hay_terraza[chapi_matriz1_xg$terraza == "TRUE"] <- 1
chapi_matriz1_xg$garaje = chapi_matriz1_xg[,"tiene_garaje"] == "1"
chapi_matriz1_xg$hay_garaje <- 0
chapi_matriz1_xg$hay_garaje[chapi_matriz1_xg$garaje == "TRUE"] <- 1
chapi_matriz1_xg <- chapi_train[,c(2,5,6,7,8,9,11,13)]
chapi_matriz1_xg <- st.matrix(chapi_matriz1_xg)
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg$identificador <- 1:13473
chapi_matriz1_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
chapi_matriz1_xg$hay_terraza <- 0
chapi_matriz1_xg$hay_terraza[chapi_matriz1_xg$terraza == "TRUE"] <- 1
chapi_matriz1_xg$garaje = chapi_matriz1_xg[,"tiene_garaje"] == "1"
chapi_matriz1_xg$hay_garaje <- 0
chapi_matriz1_xg$hay_garaje[chapi_matriz1_xg$garaje == "TRUE"] <- 1
chapi_matriz1_xg <- chapi_matriz1_xg[,c(2,5,6,7,8,9,11,13)]
View(chapi_matriz1_xg)
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:squarederror")
View(chapi_matriz1_xg)
View(chapi_matriz1_xg)
price <- as.numeric(chapi_matriz1_xg$price)
prueba$price <- as.numeric(chapi_matriz1_xg$price)
prueba$price <- as.numeric(price)
prueba$price <- as.numeric(chapi_train$price)
price <- as.numeric(chapi_train$price)
price <- data.frame(price)
price <- as.matrix(price)
View(price)
View(price)
st_east <- as.numeric(chapi_train$dist_east)
st_east <- data.frame(chapi_train$dist_east)
st_east <- as.numeric(chapi_train$dist_east)
st_east <- data.frame(dist_east)
st_east <- data.frame(st_east)
st_east <- as.matrix(st_east)
prueba_mat <- cbind(c[price,st_east])
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,6,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
View(chapi_matriz1_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:squarederror")
chapi_matriz1_xg <- chapi_train[,c(1,3,4,5,6,9,10,11)]
chapi_matriz1_xg$identificador <- 1:13473
chapi_matriz1_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
chapi_matriz1_xg$hay_terraza <- 0
chapi_matriz1_xg$hay_terraza[chapi_matriz1_xg$terraza == "TRUE"] <- 1
chapi_matriz1_xg$garaje = chapi_matriz1_xg[,"tiene_garaje"] == "1"
chapi_matriz1_xg$hay_garaje <- 0
chapi_matriz1_xg$hay_garaje[chapi_matriz1_xg$garaje == "TRUE"] <- 1
chapi_matriz1_xg <- chapi_matriz1_xg[,c(2,5,6,7,8,9,11,13)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
write.csv(numeric_matrix_chapi,"numeric_matrix_chapi")
numeric_matrix_chapi <- chapi_matriz1_xg
write.csv(numeric_matrix_chapi,"numeric_matrix_chapi")
chapi_1 <- chapi_train$price ~ chapi_train$dist_east+chapi_train$dist_chapi_bus + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface
med_1 <- house_train_med$price ~ house_train_med$dist_cerros + house_train_med$dist_med_bus + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface
chapi_train$dist_chapi_bus2 <- chapi_train$dist_east + chapi_train$dist_chapi_bus*chapi_train$dist_chapi_bus
chapi_train$dist_east2 <- chapi_train$dist_east*chapi_train$dist_east
chapi_train$surface2 <- chapi_train$surface*chapi_train$surface
house_train_med$dist_med_bus2 <- house_train_med$dist_med_bus*house_train_med$dist_med_bus
house_train_med$dist_golf2 <- house_train_med$dist_golf*house_train_med$dist_golf
house_train_med$surface2 <- house_train_med$surface*house_train_med$surface
house_train_med$surface2 <- house_train_med$surface*house_train_med$surface
chapi_2 <- chapi_train$price ~ chapi_train$dist_east2 + chapi_train$dist_chapi_bus2 + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface2
med_2 <- house_train_med$price ~ house_train_med$dist_golf2 + house_train_med$dist_med_bus2 + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface2
chapi_1 <- chapi_train$price ~ chapi_train$dist_east+chapi_train$dist_chapi_bus + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface
med_1 <- house_train_med$price ~ house_train_med$dist_golf + house_train_med$dist_med_bus + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface
house_train_med$price <-unlist(house_train_med$price)
lm_chapi1 <- lm(chapi_1, data=chapi_train)
pred_ols_chapi1 <- predict(lm_chapi1)
lm_chapi2 <- lm(chapi_2, data=chapi_train)
pred_ols_chapi2 <- predict(lm_chapi2)
house_train_med$price <-unlist(house_train_med$price)
lm_med1 <- lm(med_1, data=house_train_med)
pred_ols_med1 <- predict(lm_med1)
lm_med2 <- lm(med_2, data=house_train_med)
pred_ols_med2 <- predict(lm_med2)
rf_med1 <- rpart(med_1, data=house_train_med)
rf_med2 <- rpart(med_2, data=house_train_med)
View(rf_med2)
summary(rf_med1)
summary(rf_med2)
summary(rf_chapi1)
summaryrf_chapi2
rf_chapi2 <- rpart(chapi_2, data=chapi_train)
summaryrf_chapi2
summary(rf_chapi2)
chapi_2 <- chapi_train$price ~ chapi_train$dist_east2 + chapi_train$dist_chapi_bus2 + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface2
med_2 <- house_train_med$price ~ house_train_med$dist_golf2 + house_train_med$dist_med_bus2 + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface2
rf_chapi1 <- rpart(chapi_1, data=chapi_train)
summary(rf_chapi1)
rf_chapi2 <- rpart(chapi_2, data=chapi_train)
summary(rf_chapi2)
View(chapi_train)
summary(pred_ols_chapi1)
chapi_2 <- chapi_train$price ~ chapi_train$dist_east2 + chapi_train$dist_chapi_bus2 + chapi_train$bedrooms + chapi_train$tiene_terraza + chapi_train$tiene_garaje+ chapi_train$surface2
med_2 <- house_train_med$price ~ house_train_med$dist_golf2 + house_train_med$dist_med_bus2 + house_train_med$bedrooms + house_train_med$tiene_terraza + house_train_med$tiene_garaje+ house_train_med$surface2
summary(chapi_1)
View(house_train_med)
rf_chapi1 <- rpart(chapi_1, data=chapi_train)
summary(rf_chapi1)
rf_chapi1 <- rpart(chapi_1, data=chapi_train,method="class", minsplit = 100, minbucket=300)
summary(rf_chapi1)
rf_chapi1 <- rpart(chapi_1, data=chapi_train, minsplit = 100, minbucket=300)
summary(rf_chapi1)
rf_chapi1 <- rpart(chapi_1, data=chapi_train)
summary(rf_chapi1)
rf_chapi2 <- rpart(chapi_2, data=chapi_train)
summary(rf_chapi2)
rf_med1 <- rpart(med_1, data=house_train_med)
summary(rf_med1)
rf_med2 <- rpart(med_2, data=house_train_med)
summary(rf_med2)
View(house_train_med)
med_matriz1_xg <- house_train_med[,c(1,3,4,5,6,9,10,11)]
med_matriz1_xg$identificador <- 1:21356
med_matriz1_xg$terraza = med_matriz1_xg[,"tiene_terraza"] == "1"
med_matriz1_xg$hay_terraza <- 0
med_matriz1_xg$hay_terraza[med_matriz1_xg$terraza == "TRUE"] <- 1
med_matriz1_xg$garaje = med_matriz1_xg[,"tiene_garaje"] == "1"
med_matriz1_xg$hay_garaje <- 0
med_matriz1_xg$hay_garaje[med_matriz1_xg$garaje == "TRUE"] <- 1
View(house_train_med)
View(med_matriz1_xg)
View(chapi_train)
chapi_matriz_xg <- chapi_train[,c(1,3,4,5,6,9,10,11,12,13,14)]
chapi_matriz_xg$identificador <- 1:13473
chapi_matriz_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
chapi_matriz_xg$hay_terraza <- 0
chapi_matriz_xg$hay_terraza[chapi_matriz1_xg$terraza == "TRUE"] <- 1
chapi_matriz_xg$garaje = chapi_matriz1_xg[,"tiene_garaje"] == "1"
chapi_matriz_xg$hay_garaje <- 0
chapi_matriz_xg$hay_garaje[chapi_matriz1_xg$garaje == "TRUE"] <- 1
chapi_matriz_xg <- chapi_train[,c(1,3,4,5,6,9,10,11,12,13,14)]
View(chapi_matriz_xg)
chapi_matriz_xg$identificador <- 1:13473
chapi_matriz_xg$terraza = chapi_matriz1_xg[,"tiene_terraza"] == "1"
chapi_matriz_xg$terraza = chapi_matriz_xg[,"tiene_terraza"] == "1"
chapi_matriz_xg$hay_terraza <- 0
chapi_matriz_xg$hay_terraza[chapi_matriz_xg$terraza == "TRUE"] <- 1
chapi_matriz_xg$garaje = chapi_matriz_xg[,"tiene_garaje"] == "1"
chapi_matriz_xg$hay_garaje <- 0
chapi_matriz_xg$hay_garaje[chapi_matriz_xg$garaje == "TRUE"] <- 1
chapi_matriz1_xg <- chapi_matriz1_xg[,c(2,5,6,7,8,9,11,13)]
chapi_matriz1_xg <- chapi_matriz_xg[,c(2,5,6,7,8,9,11,13)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
View(chapi_matriz_xg)
chapi_matriz1_xg <- chapi_matriz_xg[,c(2,5,6,7,8,12,14,16)]
chapi_matriz1_xg <- as.matrix(chapi_matriz1_xg)
chapi_matriz2 <- chapi-matriz_xg[,c(2,5,6,9,10,11,12,14,16)]
chapi_matriz2 <- chapi_matriz_xg[,c(2,5,6,9,10,11,12,14,16)]
chapi_matriz2_xg <- chapi_matriz_xg[,c(2,5,6,9,10,11,12,14,16)]
chapi_matriz2_xg <- as.matrix(chapi_matriz2_xg)
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_chapi2 <- xgboost(data = chapi_matriz2_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_chapi2 <- xgboost(data = chapi_matriz2_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
med_matriz_xg <- house_train_med[,c(1,3,4,5,6,9,10,11,12,13,14)]
View(med_matriz_xg)
med_matriz_xg$identificador <- 1:21356
med_matriz_xg$terraza = med_matriz_xg[,"tiene_terraza"] == "1"
med_matriz_xg$hay_terraza <- 0
med_matriz_xg$hay_terraza[med_matriz_xg$terraza == "TRUE"] <- 1
med_matriz_xg$garaje = med_matriz_xg[,"tiene_garaje"] == "1"
med_matriz_xg$hay_garaje <- 0
med_matriz_xg$hay_garaje[med_matriz_xg$garaje == "TRUE"] <- 1
View(med_matriz_xg)
med_matriz1_xg <- med_matriz_xg[,c(2,5,6,7,8,12,14,16)]
View(med_matriz1_xg)
med_matriz1_xg <- as.matrix(med_matriz1_xg)
View(med_matriz1_xg)
View(chapi_matriz2_xg)
xgb_chapi2 <- xgboost(data = chapi_matriz2_xg[,c(1,2,3,4,5,6,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
med_matriz2_xg <- med_matriz_xg[,c(2,5,6,9,10,11,12,14,16)]
med_matriz2_xg <- as.matrix(med_matriz2_xg)
View(med_matriz1_xg)
View(med_matriz2_xg)
xgb_pob1 <- xgboost(data = med_matriz1_xg[,c(1,2,3,4,5,7,8)], label = pob_train$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,7,8)], label = chapi_matriz1_xg$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_chapi1 <- xgboost(data = chapi_matriz1_xg[,c(1,2,3,4,5,7,8)], label = chapi_train$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_pob1 <- xgboost(data = med_matriz1_xg[,c(1,2,3,4,5,7,8)], label = house_train_med$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:logistic")
xgb_pob1 <- xgboost(data = med_matriz1_xg[,c(1,2,3,4,5,7,8)], label = house_train_med$price, max.depth = 6, eta = 0.5, nrounds = 2, objective = "reg:squarederror")
xgb_pob1 <- xgboost(data = med_matriz1_xg[,c(1,2,3,4,5,7,8)], label = house_train_med$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_pob2 <- xgboost(data = med_matriz2_xg[,c(1,2,3,4,5,6,8)], label = house_train_med$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
xgb_pob1 <- xgboost(data = med_matriz1_xg[,c(1,2,3,4,5,7,8)], label = house_train_med$price, max.depth = 6, eta = 0.5, nrounds = 100, objective = "reg:squarederror")
install.packages("SuperLearner")
fitprice_chapi <- SuperLearner(Y=price, X=chapi_train(x),
method = "method.NNLS", SL.library = c("SL.lm","SL.rpart","SL.xgboost"))
install.packages("SuperLearner")
require("SuperLearner")
fitprice_chapi <- SuperLearner(Y=price, X=chapi_train(x),
method = "method.NNLS", SL.library = c("SL.lm","SL.rpart","SL.xgboost"))
View(chapi_train)
fitprice_chapi <- SuperLearner(Y=price, X= dist_east+dist_chapi_bus+tiene_terraza+tiene_garaje+bedrooms+surface,
method = "method.NNLS", SL.library = c("SL.lm","SL.rpart","SL.xgboost"))
fitprice_chapi <- SuperLearner(Y=chapi_train$price, X= chapi_train$dist_east+chapi_train$dist_chapi_bus+chapi_train$tiene_terraza+chapi_train$tiene_garaje+chapi_train$bedrooms+chapi_train$surface,
method = "method.NNLS", SL.library = c("SL.lm","SL.rpart","SL.xgboost"))
fitprice_chapi <- SuperLearner(Y=chapi_matriz_xg$price, X= chapi_matriz_xg$dist_east+chapi_matriz_xg$dist_chapi_bus+chapi_matriz_xg$hay_terraza+chapi_matriz_xg$hay_garaje+chapi_matriz_xg$bedrooms+chapi_matriz_xg$surface,
method = "method.NNLS", SL.library = c("SL.lm","SL.rpart","SL.xgboost"))
base1_capi <- as.data.frame(chapi_matriz_xg)
fitprice_chapi <- SuperLearner(Y=base1_capi$price, X= base1_capi$dist_east+base1_capi$dist_chapi_bus+base1_capi$hay_terraza+base1_capi$hay_garaje+base1_capi$bedrooms+base1_capi$surface,
method = "method.NNLS", SL.library = c("SL.lm","SL.rpart","SL.xgboost"))
